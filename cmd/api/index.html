<!DOCTYPE html>
<html lang="en">
<head>
    <script src="https://www.paypal.com/sdk/js?client-id=AdOhTlMi0m4_ssuz3-3bjF4oU_Nv2Ekh-QbCXr9THeK91splN2PKUPQM1xr9rsHOTS5HloMq_NNiPnHH&components=buttons,hosted-fields&vault=true&intent=subscription"></script>
</head>
<body>
    <div id="card-number" class="card-field"></div>
    <div id="expiration-date" class="card-field"></div>
    <div id="cvv" class="card-field"></div>
    
    <button id="pay-button">Pay & Subscribe</button>

    <script>
        // Check if the user's account is eligible for Advanced Cards
        if (paypal.HostedFields.isEligible()) {
            paypal.HostedFields.render({
                createSubscription: function () {
                    // This creates the subscription definition BEFORE the card is charged
                    return fetch('YOUR_GO_BACKEND/api/create-subscription-id', {
                        method: 'POST'
                    }).then(function(res) {
                        return res.json();
                    }).then(function(data) {
                        return data.subscriptionID; // e.g., "I-12345678"
                    });
                },
                fields: {
                    number: { selector: '#card-number' },
                    cvv: { selector: '#cvv' },
                    expirationDate: { selector: '#expiration-date' }
                }
            }).then(function (hostedFieldsInstance) {
                // When the user clicks your custom "Pay" button
                document.querySelector('#pay-button').addEventListener('click', function () {
                    
                    // This securely submits the card directly to PayPal and activates the subscription
                    hostedFieldsInstance.submit().then(function (payload) {
                        console.log('Subscription Activated!', payload);
                        
                        // Tell your Go backend it was successful
                        fetch('YOUR_GO_BACKEND/api/subscription-success', {
                            method: 'POST',
                            body: JSON.stringify({ subscriptionID: payload.subscriptionId })
                        }).then(() => {
                            window.location.href = "/thank-you";
                        });

                    }).catch(function (err) {
                        console.error('Payment failed', err);
                    });
                });
            });
        }
    </script>
</body>
</html>